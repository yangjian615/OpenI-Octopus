# 上传文件时的细节操作问题

* 支持客户端并发上传同一个文件的不同文件块
  
* 临时文件命名规则 `filenameT_total_seq_merged.temp`
  `filename` 是原文件的文件名（不包含上级目录）,`T`字符是分隔符，`total` 是数字，表示总共有多少个分块
  `seq` 表示有多少个分块，分块编号从 `1`开始，`merged`表示是否是合并过的文件 取值`Y` 或者`N`

* 合并时只合并`seq`连续的几个分块，且只从编号最小的开始合并，也即从`seq`为1开始，
  当1和2合并后，seq变为2，merged为`Y`,当有merged为`Y`的临时文件时，表示小于该seq的文件已经被合并了

* 当`seq` 等于`total` 时 合并完成，该文件上传成功，重命名临时文件名为目标文件名


* 负责接收上传的 goroutine 在成功接收到上传文件之后，应该向负责合并的goroutine 发送合并请求，由负责合并的
  的goroutine 负责合并哪些文件块，以及合并多少个文件块。 合并Task 的参数为：{
      task_id:"",
      filename:"",
      dir:""
  } 



  如果在所有文件块上传成功之后再进行合并，那么客户端会等待更长的时间，
  所以选择一边上传，一边尽可能的合并


# 如何判断一个上传任务是否是活跃的，如何避免多goroutine 竞争同一个本地文件资源

  * 为每个上传任务生成一个task ，并附加一个互斥锁
  * goroutine 只有在获得了互斥锁的情况下才被允许操作相关的文件
  * 为接收文件的操作添加一个读写计数器，开始接收文件时，计数器加一，接收完毕，计数器减一，只有当计数器为0，并且超过10分钟不活跃时才认为上传任务死掉了
