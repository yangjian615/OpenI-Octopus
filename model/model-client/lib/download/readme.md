# 客户端下载的代码


流程：

* 读本地`download.lock` file,如果存在则表明有一个临时的下载文件夹需要清除  // done
* 生成一个随机串作为此次下载的临时文件夹名，写入`download.lock` 文件  //done
* 请求`/download/init` 初始化下载  //done
* 根据返回的文件目录结构和文件大小，生成下载任务列表  //done
* 请求`/download` 接口，开始下载指定文件块，文件块初始命名为 `.mdzz` 文件,文件名随机,下载成功之后命名为`.temp`文件
  `.temp` 文件的文件名规则为`filename + "T_"+seq+"_"+total+"_"+merged+".temp"` 规则与服务端一样 //done

* 下载成功之后运行`Merge` 合并连续的`seq`
* 检查任务列表，查看任务是否全部成功，重新请求下载没有下载成功的文件块
* 检查并删除本地的 `.mdzz` 文件
* 检查所有的文件块是否已经合并，若有缺失则重新请求下载
* 若下载任务成功，则删除旧有的文件，移动新的文件到指定位置
* 删除出`download.lock`